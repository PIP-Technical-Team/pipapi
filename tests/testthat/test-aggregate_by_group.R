cols <- c("headcount", "poverty_gap", "poverty_severity", "watts", "mean")

rgn <- data.table::data.table(
  region_code = c("SSA","SSA","ECA","ECA",
                  "OHI","OHI","LAC","LAC","SAS","SAS","EAP","EAP",
                  "MNA","MNA"),
  reporting_year = c(2016,2017,2016,2017,2016,
                     2017,2016,2017,2016,2017,2016,2017,2016,2017),
  reporting_pop = c(1022526541,1050153672,
                    488015084.5,490225578.5,1089691233.5,1095331553,624032835,
                    630171566,1771167194,1792835608,2053190764,2068230030,
                    374755680,381212690),
  poverty_line = c(1.9,1.9,1.9,1.9,1.9,1.9,
                   1.9,1.9,1.9,1.9,1.9,1.9,1.9,1.9),
  headcount = c(0.419026562265896,
                0.412222832005299,0.0127911600671005,0.0129667599603503,
                0.00633685421755644,0.00679851619815562,0.0375763305981665,
                0.0375203927864637,0.082541482770641,0.0697477656263733,
                0.00852036702201481,0.00609902372244257,0.0524296396879835,
                0.0633104156964122),
  poverty_gap = c(0.158767275209035,
                  0.15631166747296,0.0039458022427972,0.00395467413532915,
                  0.00453215776858156,0.00467906693448787,0.013047445767279,
                  0.0130897832843562,0.0138986419217562,0.0112738577544907,
                  0.00188589581829827,0.00141208087423512,0.0144697820617706,
                  0.0182997846157987),
  poverty_severity = c(0.0817134530672167,
                       0.0804444411842587,0.00199258049509456,0.00196995345968527,
                       0.0039340291013745,0.00406307860370879,0.00697440490862418,
                       0.00694994646622193,0.00379052512232932,
                       0.00298793165358954,0.000773628716708861,0.000622149812235419,
                       0.00593466428776621,0.00768875778403206),
  watts = c(0.236721239395871,
            0.233083550753777,0.00475280775613838,0.00484468167216658,
            0.00504420563876729,0.0068177962057894,0.0168370853107737,
            0.0167859707006154,0.016450175967804,0.0132690629966993,
            0.00224990473819626,0.00165646040369595,
            0.0190714667439306,0.0243726281141478),
  mean = c(3.54019986920733,
           3.57270518148876,16.6132828889594,17.1636321945729,55.204637963436,
           55.9564071444413,16.591261366567,16.7038029735503,
           4.66995117204822,4.80237943117499,11.5622674685731,
           12.5933716160005,9.1703722570867,9.22129264384342)
)

test_that("compute_world_aggregates works as expected", {

  year <- min(rgn$reporting_year)

  wld <- compute_world_aggregates(rgn = rgn,
                                  cols = cols)
  expect_equal(nrow(wld), length(unique(rgn$reporting_year)))
  expect_true(max(wld$reporting_pop) < sum(rgn$reporting_pop))
  expect_true(wld$reporting_pop[wld$reporting_year == year] ==
                sum(rgn$reporting_pop[rgn$reporting_year == year]))

})
